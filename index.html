<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lector DM Industrial</title>
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
</head>

<body>

    <div class="app-container">
        <!-- HEADER SOLO VISIBLE EN SETUP -->
        <header id="main-header">
            <div class="header-titles">
                <h1>ESCANER DE POSTES</h1>
                <span class="sub-header">Almacen Teleco Tarragona</span>
            </div>
            <button id="settings-btn">‚öôÔ∏è</button>
        </header>

        <!-- PANTALLA 1: CONFIGURACI√ìN -->
        <div id="setup-form" class="screen active">
            <div class="form-content">
                <div class="input-group">
                    <label>C√≥digo Instalador</label>
                    <input type="text" id="installer-code" placeholder="Ej. INST-01">
                </div>
                <div class="input-group">
                    <label>N¬∫ Actuaci√≥n</label>
                    <input type="text" id="actuation-code" placeholder="Ej. ACT-2024">
                </div>
            </div>
            <button id="start-scan-btn" class="big-btn start">
                üì∏ COMENZAR ESCANEO
            </button>
        </div>

        <!-- PANTALLA 2: WORKSPACE (ESC√ÅNER + TABLA) -->
        <div id="workspace-container" class="screen hidden">

            <!-- PANE SUPERIOR: C√ÅMARA -->
            <div class="camera-pane">
                <div id="reader-container">
                    <div id="reader"></div>
                </div>
            </div>

            <!-- Panel de Controles Colapsable (Ahora incluye Ajustes y Sliders) -->
            <div id="controls-panel" class="camera-controls hidden">
                <div class="sliders-container">
                    <!-- URL SCRIPT -->
                    <div class="slider-row url-config">
                        <span class="icon">üîó</span>
                        <input type="text" id="script-url-input" placeholder="URL de Apps Script">
                    </div>
                    <!-- ZOOM (Hardware) -->
                    <div class="slider-row" id="zoom-row" style="display:none;">
                        <span class="icon">üîç</span>
                        <input type="range" id="zoom-slider" min="1" max="5" step="0.1">
                    </div>
                    <!-- BRILLO (CSS Filter) -->
                    <div class="slider-row">
                        <span class="icon">‚òÄÔ∏è</span>
                        <input type="range" id="brightness-slider" min="0.5" max="2.0" step="0.1" value="1.0">
                        <button id="torch-btn" class="icon-btn tiny" disabled>üî¶</button>
                    </div>
                    <!-- CONTRASTE (CSS Filter) -->
                    <div class="slider-row">
                        <span class="icon">üåì</span>
                        <input type="range" id="contrast-slider" min="0.5" max="2.0" step="0.1" value="1.0">
                        <div class="checkbox-config">
                            <input type="checkbox" id="sound-toggle" checked>
                            <span class="icon">üîä</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bot√≥n para retroceder (Siempre visible en workspace) -->
            <button id="stop-scan-btn" class="back-floating-btn">‚Ü©Ô∏è</button>

            <!-- PANE INFERIOR: TABLA -->
            <div class="table-pane">
                <div class="table-scroll">
                    <table id="data-table">
                        <thead>
                            <tr>
                                <th>INST</th>
                                <th>ACTUACI√ìN</th>
                                <th>C√ìDIGO</th>
                                <th style="width: 50px;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Filas din√°micas -->
                        </tbody>
                    </table>
                    <div id="empty-state">
                        <p>No hay lecturas a√∫n</p>
                        <small>Apunta al c√≥digo DataMatrix</small>
                    </div>
                </div>

                <div class="action-bar">
                    <button id="reset-btn" class="icon-btn-large secondary">üóëÔ∏è</button>
                    <button id="send-btn" class="text-btn-large primary">ENVIAR A GOOGLE üì§</button>
                </div>
            </div>
        </div>

        <!-- PANEL MODAL DE ESTADO -->
        <div id="status-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div id="modal-icon" class="modal-icon">üöÄ</div>
                <h3 id="modal-title">Enviando...</h3>
                <p id="modal-message">Contactando con Google...</p>
                <div class="modal-actions">
                    <button id="modal-cancel-btn" class="big-btn secondary hidden">CANCELAR</button>
                    <button id="modal-close-btn" class="big-btn">ACEPTAR</button>
                </div>
            </div>
        </div>

        <!-- ELIMINADO: settings-modal era un modal, ahora es el controls-panel colapsable -->

        <!-- IFRAME OCULTO PARA CAPTURAR EL ENV√çO -->
        <iframe name="silent-sender" id="silent-sender" style="display:none;"></iframe>

        <script src="html5-qrcode.min.js"></script>
        <script src="script.js"></script>
</body>

</html>